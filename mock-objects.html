<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-07-09 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140709" />
    <meta http-equiv="Content-Language" content="en" />
    <title>needle4j - hhh - Testing with Mock objects</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/needle4j/needle4j">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>needle4j</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-07-09
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.3
                          <span class="divider">|</span>
                      </li>
                                          <li class="">
                    <a href="./" title="Home">
        Home</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Testing with Mock objects</li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Main</li>
                              
      <li>
  
                          <a href="index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="getting-started.html" title="Getting started">
          <i class="none"></i>
        Getting started</a>
            </li>
                
      <li>
  
                          <a href="configuration.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="needle-testcase.html" title="Needle Testcase">
          <i class="none"></i>
        Needle Testcase</a>
            </li>
                
      <li>
  
                          <a href="database-testing.html" title="Database Testing">
          <i class="none"></i>
        Database Testing</a>
            </li>
                
      <li>
  
                          <a href="mock-objectsg.html" title="Testing with Mock objects">
          <i class="none"></i>
        Testing with Mock objects</a>
            </li>
                              <li class="nav-header">Development</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="JavaDoc">
          <i class="none"></i>
        JavaDoc</a>
            </li>
                
      <li>
  
                          <a href="http://github.com/needle4j/needle4j/" class="externalLink" title="GitHub project">
          <i class="none"></i>
        GitHub project</a>
            </li>
                
      <li>
  
                          <a href="issue-tracking.html" title="Issue tracking">
          <i class="none"></i>
        Issue tracking</a>
            </li>
                
      <li>
  
                          <a href="project-info.html" title="Project info">
          <i class="none"></i>
        Project info</a>
            </li>
                
      <li>
  
                          <a href="project-reports.html" title="project-reports">
          <i class="none"></i>
        project-reports</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Testing with Mock objects</h1>
<p>Mock objects are a useful way to write unit tests for objects that have collaborators. Needle generates Mock objects dynamically for dependencies of the components under test by default. Out-of-the-box Needle has implementations for EasyMock and Mockito. </p>
<p>To use other mock frameworks, the interface <tt>org.needle4j.mock.MockProvider</tt> must be implemented and configured in the <tt>needle.properties</tt> file.</p>
<div class="section">
<h2>Create a Mock Object<a name="Create_a_Mock_Object"></a></h2>
<p>To create a Mock object, you can annotate a field with the annotation <tt>@Mock</tt>.</p>

<div class="source">
<pre>public class Test {
  @Rule
  public NeedleRule needleRule = new NeedleRule();

  @Mock
  private EntityManager entityManagerMock;

  @Test
  public void test() throws Exception {
      ...
  }
}
</pre></div>
<p>The dependencies of an object under test are automatically initialized by the corresponding InjectionProvider. These dependencies can also injected into the testcase by using the corresponding injection annotation.</p></div>
<div class="section">
<h2>EasyMock<a name="EasyMock"></a></h2>
<p>The EasyMockProvider creates &#x201c;Nice&#x201d; Mock objects by default. Such nice mocks allow all method calls and returns appropriate empty values e.g. 0, null or false. If needed, all mocks can also be converted to use another policy by calling resetAllToNice(), resetAllToDefault() or resetAllToStrict().</p>
<p>The EasyMockProvider implementation is a subclass of EasyMockSupport. EasyMockSupport is a class that meant to be used as a helper or base class to your test cases. It will automatically register all created mocks and to replay, reset or verify them in batch instead of explicitly.</p>
<p>The following test illustrates the usage of EasyMock with Needle and the injection of generated mock objects.</p>

<div class="source">
<pre>public class AuthenticatorTest {

  @Rule
  public NeedleRule needleRule = new NeedleRule();

  @ObjectUnderTest
  private Authenticator authenticator;

  @Inject
  private EasyMockProvider mockProvider;

  @Inject
  private UserDao userDaoMock;

  @Test
  public void testAuthenticate() throws Exception {
    final User user = new UserTestdataBuilder().build();
    final String username = &quot;username&quot;;
    final String password = &quot;password&quot;;

    EasyMock.expect(userDaoMock.findBy(username, password)).andReturn(user);

    mockProvider.replayAll();
    boolean authenticated = authenticator.authenticate(username, password);
    Assert.assertTrue(authenticated);
    mockProvider.verifyAll();
  }
}
</pre></div>
<p>EasyMock is the default mock provider. Only the EasyMock library must be added to the test classpath.</p>
<p>For more details about EasyMock, please refer to the <a class="externalLink" href="http://easymock.org">EasyMock</a> documentation.</p></div>
<div class="section">
<h2>Mockito<a name="Mockito"></a></h2>
<p>Needle has also an mock provider implementation for Mockito. Mockito generates Mock objects, where by default the return value of a method is null, an empty collection or the appropriate primitive value.</p>
<p>The following test illustrates the usage of Mockito with Needle.</p>

<div class="source">
<pre>public class AuthenticatorTest {
  @Rule
  public NeedleRule needleRule = new NeedleRule();

  @ObjectUnderTest
  private Authenticator authenticator;

  @Inject
  private UserDao userDaoMock;

  @Test
  public void testAuthenticate() throws Exception {
    final User user = new UserTestdataBuilder().build();
    final String username = &quot;username&quot;;
    final String password = &quot;password&quot;;

    Mockito.when(userDaoMock.findBy(username, password)).thenReturn(user);

    Assert.assertTrue(authenticator.authenticate(username, password));

  }
}
</pre></div>
<p>To use Mockito, the mockito provider must be configured in the <tt>needle.properties</tt> file and the mockito library must be present on test classpath.</p>

<div class="source">
<pre>mock.provider=org.needle4j.mock.MockitoProvider
</pre></div>
<p>For more details about Mockito, please refer to the <a class="externalLink" href="http://mockito.org">Mockito</a> documentation.</p>
<p><b>Note:</b> You can use NeedleBuilders.needleMockitoTestRule() to automatically set the MockProvider to Mockito without touching the &#x2018;needle.properties&#x2019;. </p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2014.
          All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
